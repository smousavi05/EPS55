<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mohr-Coulomb Failure Criterion</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #f4f4f9; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; width: 100%; max-width: 1200px; }
        #chart-container { position: relative; width: 100%; max-width: 800px; margin: 20px; }
        #ui-container { width: 100%; max-width: 350px; padding: 20px; margin: 20px; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .control-group { margin-bottom: 20px; }
        h3, h4 { text-align: center; }
        h4 { margin-top: 25px; border-top: 1px solid #eee; padding-top: 15px;}
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="range"] { width: 100%; }
        #status { font-size: 1.5em; font-weight: bold; text-align: center; padding: 10px; border-radius: 5px; margin-top: 15px; }
        .stable { color: #28a745; background-color: #e9f7eb; }
        .failure { color: #dc3545; background-color: #fbebed; }
        #course-title { position: fixed; top: 10px; left: 10px; font-weight: bold; font-size: 1.2em; }
    </style>
</head>
<body>
    <div id="course-title">Harvard EPS-55</div>
    <h2>Mohr-Coulomb Failure Criterion</h2>
    
    <div class="container">
        <div id="chart-container">
            <canvas id="stressChart"></canvas>
        </div>
        <div id="ui-container">
            <div class="control-section">
                <h4>Material Properties</h4>
                <div class="control-group">
                    <label>Cohesion \(C_0\): <span id="cohesionValue">50</span> MPa</label>
                    <input type="range" id="cohesionSlider" min="0" max="100" value="50">
                </div>
                <div class="control-group">
                    <label>Friction Angle \(\phi\): <span id="frictionAngleValue">30</span>°</label>
                    <input type="range" id="frictionAngleSlider" min="0" max="45" value="30">
                </div>
            </div>
            <div class="control-section">
                <h4>Stress State</h4>
                <div class="control-group">
                    <label>Max. Principal Stress \(\sigma_1\): <span id="sigma1Value">300</span> MPa</label>
                    <input type="range" id="sigma1Slider" min="0" max="1000" value="300">
                </div>
                <div class="control-group">
                    <label>Min. Principal Stress \(\sigma_3\): <span id="sigma3Value">100</span> MPa</label>
                    <input type="range" id="sigma3Slider" min="0" max="1000" value="100">
                </div>
            </div>
            <div id="status"></div>
        </div>
    </div>

    <script>
        // DOM Elements
        const cohesionSlider = document.getElementById('cohesionSlider');
        const frictionAngleSlider = document.getElementById('frictionAngleSlider');
        const sigma1Slider = document.getElementById('sigma1Slider');
        const sigma3Slider = document.getElementById('sigma3Slider');
        
        const cohesionValue = document.getElementById('cohesionValue');
        const frictionAngleValue = document.getElementById('frictionAngleValue');
        const sigma1Value = document.getElementById('sigma1Value');
        const sigma3Value = document.getElementById('sigma3Value');
        
        const statusDiv = document.getElementById('status');
        const ctx = document.getElementById('stressChart').getContext('2d');

        // Helper functions to generate data for the chart
        function getFailureEnvelope(C0, phi, maxNormalStress) {
            const points = [];
            const phiRad = phi * Math.PI / 180;
            const mu = Math.tan(phiRad);
            for (let sn = 0; sn <= maxNormalStress; sn++) {
                // τ = C₀ + µ * σn
                const tau_failure = C0 + mu * sn;
                points.push({ x: sn, y: tau_failure });
            }
            return points;
        }

        function getMohrCircle(s1, s3) {
            const points = [];
            const center = (s1 + s3) / 2;
            const radius = (s1 - s3) / 2;
            for (let i = 0; i <= 360; i++) {
                const angle = i * Math.PI / 180;
                const x = center + radius * Math.cos(angle);
                const y = radius * Math.sin(angle);
                points.push({ x: x, y: y });
            }
            return points;
        }

        // Chart.js setup
        const stressChart = new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        type: 'line',
                        label: 'Mohr-Coulomb Failure Envelope',
                        data: [],
                        borderColor: 'rgb(220, 53, 69)',
                        borderWidth: 3,
                        pointRadius: 0,
                        tension: 0.1
                    },
                    {
                        type: 'line',
                        label: `Mohr's Circle`,
                        data: [],
                        borderColor: 'rgb(0, 123, 255)',
                        borderWidth: 3,
                        pointRadius: 0,
                        fill: 'origin',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                    },
                    {
                        type: 'scatter',
                        label: 'Principal Stresses (σ₃, σ₁)',
                        data: [],
                        backgroundColor: 'rgb(0, 0, 0)',
                        pointRadius: 7,
                        pointHoverRadius: 9
                    }
                ]
            },
            options: {
                aspectRatio: 1.5,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                        title: { display: true, text: 'Normal Stress (σn) [MPa]', font: { size: 14 } },
                        min: 0,
                        max: 1000
                    },
                    y: {
                        title: { display: true, text: 'Shear Stress (τ) [MPa]', font: { size: 14 } },
                        min: 0,
                        max: 500
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                if (context.datasetIndex === 2) {
                                    const pointLabel = context.dataIndex === 0 ? 'σ₃' : 'σ₁';
                                    return `${pointLabel}: ${context.parsed.x.toFixed(1)} MPa`;
                                }
                                return `(σn: ${context.parsed.x.toFixed(1)}, τ: ${context.parsed.y.toFixed(1)})`;
                            }
                        }
                    }
                }
            }
        });

        function updateVisualization() {
            let s1 = parseFloat(sigma1Slider.value);
            let s3 = parseFloat(sigma3Slider.value);
            const C0 = parseFloat(cohesionSlider.value); // Updated variable name
            const phi = parseFloat(frictionAngleSlider.value);
            const phiRad = phi * Math.PI / 180;
            
            if (s3 > s1) {
                [s1, s3] = [s3, s1];
                sigma1Slider.value = s1;
                sigma3Slider.value = s3;
            }

            cohesionValue.textContent = C0; // Updated variable name
            frictionAngleValue.textContent = phi;
            sigma1Value.textContent = s1;
            sigma3Value.textContent = s3;

            // Update chart data
            stressChart.data.datasets[0].data = getFailureEnvelope(C0, phi, 1000); // Updated variable name
            stressChart.data.datasets[1].data = getMohrCircle(s1, s3);
            stressChart.data.datasets[2].data = [{ x: s3, y: 0 }, { x: s1, y: 0 }];
            
            // Check for failure condition
            const circleRadius = (s1 - s3) / 2;
            const failureRadius = ((s1 + s3) / 2) * Math.sin(phiRad) + C0 * Math.cos(phiRad); // Updated variable name

            if (circleRadius >= failureRadius) {
                statusDiv.textContent = 'FAILURE';
                statusDiv.className = 'failure';
                stressChart.data.datasets[1].borderColor = '#dc3545';
                stressChart.data.datasets[1].backgroundColor = 'rgba(220, 53, 69, 0.2)';
            } else {
                statusDiv.textContent = 'STABLE';
                statusDiv.className = 'stable';
                stressChart.data.datasets[1].borderColor = '#007bff';
                stressChart.data.datasets[1].backgroundColor = 'rgba(0, 123, 255, 0.1)';
            }

            stressChart.update('none');
        }

        [cohesionSlider, frictionAngleSlider, sigma1Slider, sigma3Slider].forEach(slider => {
            slider.addEventListener('input', updateVisualization);
        });

        updateVisualization();
    </script>
</body>
</html>