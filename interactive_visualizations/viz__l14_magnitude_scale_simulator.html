<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Magnitude Scale Simulator</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f6f9; color: #2c3e50; margin: 0; padding: 20px;
        }
        h1, h2 { text-align: center; }
        .main-container {
            display: flex; flex-wrap: wrap; gap: 20px; max-width: 1600px; margin: auto;
        }
        .left-panel {
            flex: 1; min-width: 350px; background: #fff; padding: 20px;
            border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); align-self: flex-start;
        }
        .right-panel {
            flex: 2; min-width: 700px;
        }
        .control-group { margin-bottom: 25px; }
        .control-group legend {
            font-size: 1.2em; font-weight: bold; color: #277da1;
            border-bottom: 2px solid #277da1; margin-bottom: 10px; padding-bottom: 5px;
        }
        #mw-slider { width: 100%; }
        
        .meters-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;
        }
        .meter {
            background: #e9ecef; border-radius: 8px; padding: 15px; text-align: center;
            border: 2px solid #ced4da; transition: all 0.2s ease;
        }
        .meter.saturated { border-color: #f94144; background-color: #fff0f3; }
        .meter-label { font-weight: bold; font-size: 1.1em; }
        .meter-value { font-size: 2.5em; font-weight: bold; color: #43aa8b; }
        .meter.saturated .meter-value { color: #f94144; }
        .meter.saturated::after { content: 'SATURATED'; font-size: 0.7em; font-weight: bold; color: #f94144; display: block; }

        .viz-container {
            background: #fff; padding: 15px; border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-top: 20px;
        }
        canvas { width: 100%; }
    </style>
</head>
<body>

    <h1>Interactive Magnitude Scale Simulator</h1>
    <h2>Harvard EPS55</h2>
    <div class="main-container">
        <div class="left-panel">
            <div class="control-group">
                <legend>Master Control</legend>
                <label for="mw-slider"><strong>Moment Magnitude (Mw): <span id="mw-slider-value">5.0</span></strong></label>
                <input type="range" id="mw-slider" min="3.0" max="9.5" value="5.0" step="0.1">
                <p style="font-size:0.9em; color:#555;">Adjust the true size of the earthquake (Mw) and observe how other scales respond and how the waveform changes.</p>
            </div>
            <div class="control-group">
                <legend>Logarithmic Scaling</legend>
                <div class="viz-container">
                    <canvas id="log-chart"></canvas>
                </div>
            </div>
        </div>
        <div class="right-panel">
             <div class="control-group">
                <legend>Magnitude Scale Meters</legend>
                 <div class="meters-grid">
                     <div class="meter" id="ml-meter">
                         <div class="meter-label">Local (ML)</div>
                         <div class="meter-value" id="ml-value">5.0</div>
                     </div>
                     <div class="meter" id="mb-meter">
                         <div class="meter-label">Body-Wave (mb)</div>
                         <div class="meter-value" id="mb-value">5.1</div>
                     </div>
                     <div class="meter" id="ms-meter">
                         <div class="meter-label">Surface-Wave (Ms)</div>
                         <div class="meter-value" id="ms-value">5.0</div>
                     </div>
                      <div class="meter" id="mw-meter">
                         <div class="meter-label">Moment (Mw)</div>
                         <div class="meter-value" id="mw-value">5.0</div>
                     </div>
                </div>
            </div>
            <div class="viz-container">
                <canvas id="seismogram-chart"></canvas>
            </div>
        </div>
    </div>

<script>
// --- 1. SETUP & STATE MANAGEMENT ---
const mwSlider = document.getElementById('mw-slider');
const seismoChartCanvas = document.getElementById('seismogram-chart');
const logChartCanvas = document.getElementById('log-chart');

let seismoChart, logChart;

// --- 2. WAVEFORM & MAGNITUDE CALCULATION ---

function generatePacket(length, freq, amp) {
    const packet = [];
    for (let i = 0; i < length; i++) {
        const t = i - length / 2;
        const envelope = Math.exp(-((t / (length / 4)) ** 2));
        packet.push(Math.sin(i * freq) * amp * envelope);
    }
    return packet;
}

function generateSeismogramData(mw) {
    const len = 800;
    let waveform = new Array(len).fill(0).map(() => (Math.random() - 0.5) * 0.05);

    const ampScale = Math.pow(10, 1.5 * (mw - 5));
    const freqScale = 1 / (1 + Math.max(0, mw - 5) * 0.4);

    const p_amp = 0.4 * ampScale;
    const s_amp = 1.0 * ampScale;
    const surf_amp = 0.6 * ampScale * (1 + Math.max(0, mw - 6));

    const p_freq = 0.8 * freqScale;
    const s_freq = 0.5 * freqScale;
    const surf_freq = 0.1 * freqScale * 0.5;

    const p_wave = generatePacket(100, p_freq, p_amp);
    const s_wave = generatePacket(200, s_freq, s_amp);
    const surf_wave = generatePacket(400, surf_freq, surf_amp);

    for(let i=0; i<len; i++) {
        if(i > 100) waveform[i] += p_wave[i-100];
        if(i > 250) waveform[i] += s_wave[i-250];
        if(i > 400) waveform[i] += surf_wave[i-400];
    }
    return waveform;
}

function calculateMagnitudes(mw) {
    let ml, mb, ms;
    ml = mw < 6.0 ? mw : 6.0 + (mw - 6.0) * 0.4;
    mb = Math.min(6.5, 0.63 * mw + 2.5);
    ms = mw < 8.2 ? mw : 8.2;
    return { ml, mb, ms };
}

// --- 3. CHART & UI UPDATES ---

function initializeCharts() {
    seismoChart = new Chart(seismoChartCanvas, {
        type: 'line', data: { labels: [], datasets: [{ data: [], borderColor: 'black', borderWidth: 1.5 }] },
        options: {
            animation: false,
            elements: { point: { radius: 0 } },
            scales: { y: { min: -1, max: 1 } },
            plugins: {
                legend: { display: false },
                title: { // Main title for the chart
                    display: true,
                    text: 'Simulated Seismogram',
                    font: { size: 18 }
                },
                subtitle: { // Subtitle added here
                    display: true,
                    text: 'Harvard EPS55',
                    color: '#6c757d',
                    font: { size: 14, style: 'italic' },
                    padding: { bottom: 10 }
                }
            }
        }
    });
    
    logChart = new Chart(logChartCanvas, {
        type: 'bar',
        data: { labels: ['Amplitude', 'Energy'], datasets: [{ data: [1,1], backgroundColor: ['#457b9d', '#e63946'] }] },
        options: { indexAxis: 'y', scales: { x: { type: 'logarithmic', title: {display: true, text: 'Relative Increase'} } }, plugins: { legend: { display: false } } }
    });
}

function updateSimulation() {
    const mw = parseFloat(mwSlider.value);
    document.getElementById('mw-slider-value').textContent = mw.toFixed(1);

    const { ml, mb, ms } = calculateMagnitudes(mw);
    document.getElementById('ml-value').textContent = ml.toFixed(1);
    document.getElementById('mb-value').textContent = mb.toFixed(1);
    document.getElementById('ms-value').textContent = ms.toFixed(1);
    document.getElementById('mw-value').textContent = mw.toFixed(1);
    
    document.getElementById('mb-meter').classList.toggle('saturated', mb >= 6.5);
    document.getElementById('ms-meter').classList.toggle('saturated', ms >= 8.2);

    const waveformData = generateSeismogramData(mw);
    const timeLabels = Array.from({ length: waveformData.length }, (_, i) => i);
    seismoChart.data.labels = timeLabels;
    seismoChart.data.datasets[0].data = waveformData;
    const maxAmp = Math.max(1, ...waveformData.map(Math.abs));
    seismoChart.options.scales.y.min = -maxAmp;
    seismoChart.options.scales.y.max = maxAmp;
    seismoChart.update('none');

    const refMw = 3.0;
    const ampIncrease = Math.pow(10, mw - refMw);
    const energyIncrease = Math.pow(32, mw - refMw);
    logChart.data.datasets[0].data = [ampIncrease, energyIncrease];
    logChart.update();
}

// --- 4. EVENT LISTENERS & INITIALIZATION ---
mwSlider.addEventListener('input', updateSimulation);

document.addEventListener('DOMContentLoaded', () => {
    initializeCharts();
    updateSimulation();
});

</script>
</body>
</html>