<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Gutenberg-Richter Law Simulator</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f6f9; color: #2c3e50; margin: 0; padding: 20px;
        }
        h1, h2 { text-align: center; }
        .main-container {
            display: flex; flex-wrap: wrap; gap: 20px; max-width: 1400px; margin: auto;
        }
        .controls-panel {
            flex: 1; min-width: 400px; background: #fff; padding: 20px;
            border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); align-self: flex-start;
        }
        .viewer-panel {
            flex: 1.5; min-width: 600px; background: #fff; padding: 20px;
            border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .control-group { margin-bottom: 25px; }
        .control-group legend {
            font-size: 1.2em; font-weight: bold; color: #277da1;
            border-bottom: 2px solid #277da1; margin-bottom: 10px; padding-bottom: 5px;
        }
        .param-slider { margin-bottom: 15px; }
        .param-slider label { display: block; margin-bottom: 5px; }
        .param-slider input { width: 100%; }
        .preset-buttons button {
            width: 100%; padding: 8px; margin-bottom: 8px; border-radius: 5px;
            border: 1px solid #ccc; font-size: 0.9em; cursor: pointer; background-color: #f8f9fa;
        }
        .results-box {
            background-color: #e9ecef; padding: 15px; border-radius: 5px;
        }
        #interp-text { font-style: italic; color: #555; }
        #rule-of-ten-value { font-weight: bold; font-size: 1.2em; color: #f94144; }
    </style>
</head>
<body>
    <h1>Interactive Gutenberg-Richter Law Simulator 📊</h1>
    <h2>Harvard EPS55</h2>
    <div class="main-container">
        <div class="controls-panel">
            <div class="control-group">
                <legend>1. G-R Parameters</legend>
                <div class="param-slider">
                    <label for="a-slider">'a' value (Total Seismicity): <span id="a-value">5.0</span></label>
                    <input type="range" id="a-slider" min="3.0" max="7.0" value="5.0" step="0.1">
                </div>
                <div class="param-slider">
                    <label for="b-slider">'b' value (Relative Size Distribution): <span id="b-value">1.0</span></label>
                    <input type="range" id="b-slider" min="0.5" max="2.0" value="1.0" step="0.05">
                </div>
                 <div class="param-slider">
                    <label for="mc-slider">Magnitude of Completeness (Mc): <span id="mc-value">2.5</span></label>
                    <input type="range" id="mc-slider" min="2.0" max="5.0" value="2.5" step="0.1">
                </div>
            </div>
            <div class="control-group">
                <legend>2. Pre-set Regional Profiles</legend>
                <div class="preset-buttons">
                    <button data-profile="locked_fault">Locked Fault Zone (e.g., San Andreas)</button>
                    <button data-profile="volcanic_swarm">Volcanic Swarm (e.g., Yellowstone)</button>
                    <button data-profile="induced">Induced Seismicity (e.g., Oklahoma)</button>
                </div>
            </div>
            <div class="control-group">
                <legend>3. Interpretation</legend>
                <div class="results-box">
                    <h4>Geological Significance</h4>
                    <p id="interp-text"></p>
                    <hr>
                    <h4>"Rule of Ten"</h4>
                    <p>For every M7 earthquake, this region expects <span id="rule-of-ten-value">10</span> M6 earthquakes.</p>
                </div>
            </div>
        </div>
        <div class="viewer-panel">
            <canvas id="gr-chart"></canvas>
        </div>
    </div>

<script>
// --- 1. SETUP & STATE MANAGEMENT ---
const sliders = {
    a: document.getElementById('a-slider'),
    b: document.getElementById('b-slider'),
    mc: document.getElementById('mc-slider')
};
const displays = {
    a: document.getElementById('a-value'),
    b: document.getElementById('b-value'),
    mc: document.getElementById('mc-value'),
    interp: document.getElementById('interp-text'),
    ruleOfTen: document.getElementById('rule-of-ten-value')
};

const PROFILES = {
    locked_fault: { a: 4.5, b: 0.8, interp: "A **low b-value (b < 1.0)** often indicates a high-stress environment where strain is accumulating on major faults. This increases the proportion of large earthquakes relative to small ones." },
    volcanic_swarm: { a: 6.0, b: 1.5, interp: "A **high b-value (b > 1.2)** is typical of volcanic swarms or highly fractured rock volumes. This indicates a low-stress environment where it's easier to generate many small events than to build up strain for a large one." },
    induced: { a: 5.5, b: 1.2, interp: "Induced seismicity often shows a **moderate to high b-value**, reflecting the activation of many small, optimally oriented pre-existing fractures by changes in pore pressure." }
};

let grChart;

// --- 2. CHART CONFIGURATION & UPDATE ---
const MAGNITUDES = Array.from({length: 13}, (_, i) => 2 + i * 0.5); // M 2.0 to 8.0

function initializeChart() {
    const ctx = document.getElementById('gr-chart').getContext('2d');
    grChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: MAGNITUDES,
            datasets: [{
                label: 'Cumulative Number of Earthquakes',
                data: [],
                borderColor: '#277da1',
                borderWidth: 3,
                tension: 0.1
            }, {
                label: 'Below Mc (Incomplete Data)',
                data: [],
                borderColor: '#adb5bd',
                borderWidth: 2,
                borderDash: [5, 5]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    type: 'logarithmic',
                    title: { display: true, text: 'Log₁₀(Number of Earthquakes ≥ M)' }
                },
                x: {
                    title: { display: true, text: 'Magnitude (M)' }
                }
            },
            plugins: {
                title: { display: true, text: 'Gutenberg-Richter Magnitude-Frequency Distribution', font: {size: 18}},
                legend: { display: false }
            }
        }
    });
}

function updateSimulation() {
    const a = parseFloat(sliders.a.value);
    const b = parseFloat(sliders.b.value);
    const mc = parseFloat(sliders.mc.value);
    
    // Update display values
    displays.a.textContent = a.toFixed(1);
    displays.b.textContent = b.toFixed(2);
    displays.mc.textContent = mc.toFixed(1);

    // Calculate G-R data
    const completeData = [];
    const incompleteData = [];

    MAGNITUDES.forEach(m => {
        const logN = a - b * m;
        const N = Math.pow(10, logN);
        if (m >= mc) {
            completeData.push({x: m, y: N});
            incompleteData.push({x: m, y: NaN}); // Leave a gap in the incomplete data
        } else {
            completeData.push({x: m, y: NaN});
            incompleteData.push({x: m, y: N});
        }
    });
    // Ensure lines connect smoothly at Mc
    const mc_logN = a - b * mc;
    const mc_N = Math.pow(10, mc_logN);
    completeData.unshift({x: mc, y: mc_N});
    incompleteData.push({x: mc, y: mc_N});
    
    grChart.data.datasets[0].data = completeData.sort((p1, p2) => p1.x - p2.x);
    grChart.data.datasets[1].data = incompleteData.sort((p1, p2) => p1.x - p2.x);
    grChart.update();

    // Update interpretation panel
    if (b < 0.9) displays.interp.innerHTML = PROFILES.locked_fault.interp;
    else if (b > 1.2) displays.interp.innerHTML = PROFILES.volcanic_swarm.interp;
    else displays.interp.innerHTML = "A **'normal' b-value (b ≈ 1.0)** represents a typical balance between small and large earthquakes in a moderately stressed tectonic region.";

    // Update Rule of Ten
    displays.ruleOfTen.textContent = Math.pow(10, b).toFixed(1);
}


// --- 3. EVENT LISTENERS ---
Object.values(sliders).forEach(slider => {
    slider.addEventListener('input', updateSimulation);
});

document.querySelectorAll('.preset-buttons button').forEach(button => {
    button.addEventListener('click', () => {
        const profile = PROFILES[button.dataset.profile];
        if (profile) {
            sliders.a.value = profile.a;
            sliders.b.value = profile.b;
            displays.interp.innerHTML = profile.interp.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            updateSimulation();
        }
    });
});


// --- 4. INITIALIZATION ---
document.addEventListener('DOMContentLoaded', () => {
    initializeChart();
    updateSimulation();
});

</script>
</body>
</html>
